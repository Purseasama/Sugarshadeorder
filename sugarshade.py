# -*- coding: utf-8 -*-
"""Sugarshade.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1j4SyoX7F3RGe4BUOBFPK6zMGrUkRW49y
"""

import streamlit as st
import pandas as pd
import os
import requests
from PIL import Image

# LINE Notify Token (Replace with your actual token)
LINE_NOTIFY_TOKEN = "cFNP09HM6p72xrzSbqeiTrXHN81WYfbL1d8Spjp3Izi"

# Add Logo
logo_path = "sugarshade_logo.png"  # Ensure your logo is in the same directory
if os.path.exists(logo_path):
    st.image(logo_path, width=200)

# Streamlit App Title
st.title("‚ú® Sugar Shade")
st.subheader("‡πÄ‡∏Ñ‡πâ‡∏Å‡∏õ‡∏≠‡∏ô‡∏î‡πå")

# Customer Details
customer_name = st.text_input("üíå‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ Line")
phone_number = st.text_input("‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå", max_chars=15, placeholder=" XXX-XXX-XXXX")

# Cake Selection
cake_base = st.selectbox("‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏Ñ‡πâ‡∏Å:", ["‡∏ß‡∏≤‡∏ô‡∏¥‡∏•‡∏•‡∏≤", "‡∏ä‡πá‡∏≠‡∏Ñ‡πÇ‡∏Å‡πÅ‡∏•‡∏ï"])
cake_filling = st.selectbox("‡πÑ‡∏™‡πâ:", ["üçì ‡∏™‡∏ï‡∏£‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà", "üç´ ‡∏ä‡πá‡∏≠‡∏Ñ‡πÇ‡∏Å‡πÅ‡∏•‡∏ï", "ü´ê ‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà", "üçØ ‡∏Ñ‡∏≤‡∏£‡∏≤‡πÄ‡∏°‡∏•"])
cake_size = st.selectbox("‡∏Ç‡∏ô‡∏≤‡∏î:", ["0.5 ‡∏õ‡∏≠‡∏ô‡∏î‡πå", "1 ‡∏õ‡∏≠‡∏ô‡∏î‡πå", "1.5 ‡∏õ‡∏≠‡∏ô‡∏î‡πå"])

# Cake Color Selection
cake_color_options = ["‡∏ä‡∏°‡∏û‡∏π", "‡∏ü‡πâ‡∏≤", "‡∏Ç‡∏≤‡∏ß", "‡∏î‡∏≥", "‡∏°‡πà‡∏ß‡∏á", "‡∏™‡∏µ‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏"]
cake_color_choice = st.selectbox("‡∏™‡∏µ‡πÄ‡∏Ñ‡πâ‡∏Å:", cake_color_options)

if cake_color_choice == "‡∏™‡∏µ‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏":
    custom_cake_color = st.text_input("‡∏™‡∏µ‡∏≠‡∏∑‡πà‡∏ô‡πÜ")
    cake_color = custom_cake_color if custom_cake_color else "Not Specified"
else:
    cake_color = cake_color_choice

cake_text = st.text_input("‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ô‡πÄ‡∏Ñ‡πâ‡∏Å/‡∏ê‡∏≤‡∏ô", placeholder="‡πÄ‡∏ä‡πà‡∏ô Happy birthday!")
cake_specification = st.text_input("‡∏ö‡∏£‡∏µ‡∏ü‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏´‡∏≤‡∏Å‡∏°‡∏µ)", placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡πÇ‡∏ö‡∏ß‡πå‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥")

# Upload Cake Reference Image
uploaded_file = st.file_uploader("üì∑ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡πâ‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)", type=["jpg", "png", "jpeg"])

# Save uploaded file
image_path = None
if uploaded_file is not None:
    image_path = os.path.join("uploaded_images", uploaded_file.name)
    os.makedirs("uploaded_images", exist_ok=True)
    with open(image_path, "wb") as f:
        f.write(uploaded_file.getbuffer())
    st.image(image_path, caption="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡πâ‡∏Å", use_column_width=True)

# Selecting candle
candle_type = st.radio("‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô (‡πÅ‡∏ó‡πà‡∏á‡∏•‡∏∞ 10 ‡∏ö‡∏≤‡∏ó):", ["‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏ß", "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡πâ‡∏ô‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π", "‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô"])

if candle_type != "‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô":
    num_candles = st.slider("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡πÅ‡∏ó‡πà‡∏á):", min_value=1, max_value=10, value=1)
else:
    num_candles = 0

# Delivery details
delivery_date = st.date_input("‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡πâ‡∏Å")
delivery_time = st.time_input("‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡πâ‡∏Å")
delivery_option = st.radio("‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡πà‡∏á:", ["‡∏°‡∏≤‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á", "‡∏£‡∏ñ‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏ï‡πå", "‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå"])
delivery_location = st.text_input("‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á (‡∏´‡∏≤‡∏Å‡∏°‡∏≤‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà)", placeholder="‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡πÄ‡∏õ‡πá‡∏ô Google Link ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ")

# File to store orders
ORDER_FILE = "sugarshade_orders.csv"

# Order Placement
if st.button("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå"):
    if not customer_name or not phone_number:
        st.error("‚ö†Ô∏è ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö (‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå)")
    else:
        order_data = {
            "Customer Name": [customer_name],
            "Phone Number": [phone_number],
            "Cake Base": [cake_base],
            "Cake Filling": [cake_filling],
            "Cake Size": [cake_size],
            "Cake Color": [cake_color],
            "Cake Text": [cake_text],
            "Cake Specification": [cake_specification],
            "Candle Type": [candle_type],
            "Candle Count": [num_candles],
            "Delivery Date": [delivery_date],
            "Delivery Time": [delivery_time],
            "Deliver Option": [delivery_option],
            "Delivery Location": [delivery_location],
            "Cake Image": [image_path if image_path else "No Image"]
        }

        df = pd.DataFrame(order_data)

        try:
            if os.path.exists(ORDER_FILE):
                df.to_csv(ORDER_FILE, mode="a", index=False, header=False)
            else:
                df.to_csv(ORDER_FILE, mode="w", index=False, header=True)

            st.success("‚úÖ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß")

            # Generate Order Summary for LINE
            order_summary = f"""
üíå K.{customer_name}
üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: {phone_number}

üéÇ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏Ñ‡πâ‡∏Å
- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏Ñ‡πâ‡∏Å: {cake_base}
- ‡πÑ‡∏™‡πâ: {cake_filling}
- ‡∏Ç‡∏ô‡∏≤‡∏î: {cake_size}
- ‡∏™‡∏µ‡πÄ‡∏Ñ‡πâ‡∏Å: {cake_color}
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: {cake_text}
- ‡∏ö‡∏£‡∏µ‡∏ü‡∏≠‡∏∑‡πà‡∏ô‡πÜ: {cake_specification}

üïØÔ∏è ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô
- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: {candle_type} ({num_candles} ‡πÅ‡∏ó‡πà‡∏á)

üöó ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
- ‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡πâ‡∏Å: {delivery_date}
- ‡πÄ‡∏ß‡∏•‡∏≤: {delivery_time}
- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: {delivery_option}
- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö: {delivery_location}
            """

            # Send order notification to LINE with image
            requests.post(
                "https://notify-api.line.me/api/notify",
                headers={"Authorization": f"Bearer {LINE_NOTIFY_TOKEN}"},
                data={"message": order_summary},
                files={"imageFile": open(image_path, "rb")} if image_path else None
            )

            # Show Order Summary Immediately
            st.subheader("üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå")
            st.write(order_summary)

            if image_path:
                st.image(image_path, caption="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡πâ‡∏Å", use_column_width=True)

        except Exception as e:
            st.error(f"‚ö†Ô∏è Error saving order: {e}")

# Admin Section (Hidden from customers)
st.divider()
st.subheader("üîí Admin Access")
st.text("‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô")

admin_password = st.text_input("Enter Admin Password", type="password")

if admin_password == "PurseAdmin":
    if st.button("View Orders"):
        try:
            orders_df = pd.read_csv(ORDER_FILE)
            st.write(orders_df)
        except FileNotFoundError:
            st.error("No orders found yet.")
else:
    st.warning("üîê Enter the admin password to view orders.")